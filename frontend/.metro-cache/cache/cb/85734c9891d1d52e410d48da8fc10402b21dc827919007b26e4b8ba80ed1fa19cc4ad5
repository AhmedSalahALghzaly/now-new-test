{"dependencies":[{"name":"./chunk-PXG64RU4.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":29,"index":29}}],"key":"95n72RjXuns6nOHwcOieKivptHg=","exportNames":["*"],"imports":1}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":55},"end":{"line":4,"column":61,"index":116}}],"key":"NIaSEHO1E48gsZc7jH9Ex1xTHgE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"streamedQuery\", {\n    enumerable: true,\n    get: function () {\n      return streamedQuery;\n    }\n  });\n  require(_dependencyMap[0], \"./chunk-PXG64RU4.js\");\n  var _utilsJs = require(_dependencyMap[1], \"./utils.js\");\n  // src/streamedQuery.ts\n\n  function streamedQuery({\n    streamFn,\n    refetchMode = \"reset\",\n    reducer = (items, chunk) => (0, _utilsJs.addToEnd)(items, chunk),\n    initialValue = []\n  }) {\n    return async context => {\n      const query = context.client.getQueryCache().find({\n        queryKey: context.queryKey,\n        exact: true\n      });\n      const isRefetch = !!query && query.state.data !== void 0;\n      if (isRefetch && refetchMode === \"reset\") {\n        query.setState({\n          status: \"pending\",\n          data: void 0,\n          error: null,\n          fetchStatus: \"fetching\"\n        });\n      }\n      let result = initialValue;\n      let cancelled = false;\n      const streamFnContext = (0, _utilsJs.addConsumeAwareSignal)({\n        client: context.client,\n        meta: context.meta,\n        queryKey: context.queryKey,\n        pageParam: context.pageParam,\n        direction: context.direction\n      }, () => context.signal, () => cancelled = true);\n      const stream = await streamFn(streamFnContext);\n      const isReplaceRefetch = isRefetch && refetchMode === \"replace\";\n      for await (const chunk of stream) {\n        if (cancelled) {\n          break;\n        }\n        if (isReplaceRefetch) {\n          result = reducer(result, chunk);\n        } else {\n          context.client.setQueryData(context.queryKey, prev => reducer(prev === void 0 ? initialValue : prev, chunk));\n        }\n      }\n      if (isReplaceRefetch && !cancelled) {\n        context.client.setQueryData(context.queryKey, result);\n      }\n      return context.client.getQueryData(context.queryKey) ?? initialValue;\n    };\n  }\n});","lineCount":64,"map":[[7,2,56,0,"Object"],[7,8,56,0],[7,9,56,0,"defineProperty"],[7,23,56,0],[7,24,56,0,"exports"],[7,31,56,0],[8,4,56,0,"enumerable"],[8,14,56,0],[9,4,56,0,"get"],[9,7,56,0],[9,18,56,0,"get"],[9,19,56,0],[10,6,56,0],[10,13,57,2,"streamedQuery"],[10,26,57,15],[11,4,57,15],[12,2,57,15],[13,2,1,0,"require"],[13,9,1,0],[13,10,1,0,"_dependencyMap"],[13,24,1,0],[14,2,4,0],[14,6,4,0,"_utilsJs"],[14,14,4,0],[14,17,4,0,"require"],[14,24,4,0],[14,25,4,0,"_dependencyMap"],[14,39,4,0],[15,2,3,0],[17,2,5,0],[17,11,5,9,"streamedQuery"],[17,24,5,22,"streamedQuery"],[17,25,5,23],[18,4,6,2,"streamFn"],[18,12,6,10],[19,4,7,2,"refetchMode"],[19,15,7,13],[19,18,7,16],[19,25,7,23],[20,4,8,2,"reducer"],[20,11,8,9],[20,14,8,12,"reducer"],[20,15,8,13,"items"],[20,20,8,18],[20,22,8,20,"chunk"],[20,27,8,25],[20,32,8,30],[20,36,8,30,"addToEnd"],[20,44,8,38],[20,45,8,38,"addToEnd"],[20,53,8,38],[20,55,8,39,"items"],[20,60,8,44],[20,62,8,46,"chunk"],[20,67,8,51],[20,68,8,52],[21,4,9,2,"initialValue"],[21,16,9,14],[21,19,9,17],[22,2,10,0],[22,3,10,1],[22,5,10,3],[23,4,11,2],[23,11,11,9],[23,17,11,16,"context"],[23,24,11,23],[23,28,11,28],[24,6,12,4],[24,12,12,10,"query"],[24,17,12,15],[24,20,12,18,"context"],[24,27,12,25],[24,28,12,26,"client"],[24,34,12,32],[24,35,12,33,"getQueryCache"],[24,48,12,46],[24,49,12,47],[24,50,12,48],[24,51,12,49,"find"],[24,55,12,53],[24,56,12,54],[25,8,12,56,"queryKey"],[25,16,12,64],[25,18,12,66,"context"],[25,25,12,73],[25,26,12,74,"queryKey"],[25,34,12,82],[26,8,12,84,"exact"],[26,13,12,89],[26,15,12,91],[27,6,12,96],[27,7,12,97],[27,8,12,98],[28,6,13,4],[28,12,13,10,"isRefetch"],[28,21,13,19],[28,24,13,22],[28,25,13,23],[28,26,13,24,"query"],[28,31,13,29],[28,35,13,33,"query"],[28,40,13,38],[28,41,13,39,"state"],[28,46,13,44],[28,47,13,45,"data"],[28,51,13,49],[28,56,13,54],[28,61,13,59],[28,62,13,60],[29,6,14,4],[29,10,14,8,"isRefetch"],[29,19,14,17],[29,23,14,21,"refetchMode"],[29,34,14,32],[29,39,14,37],[29,46,14,44],[29,48,14,46],[30,8,15,6,"query"],[30,13,15,11],[30,14,15,12,"setState"],[30,22,15,20],[30,23,15,21],[31,10,16,8,"status"],[31,16,16,14],[31,18,16,16],[31,27,16,25],[32,10,17,8,"data"],[32,14,17,12],[32,16,17,14],[32,21,17,19],[32,22,17,20],[33,10,18,8,"error"],[33,15,18,13],[33,17,18,15],[33,21,18,19],[34,10,19,8,"fetchStatus"],[34,21,19,19],[34,23,19,21],[35,8,20,6],[35,9,20,7],[35,10,20,8],[36,6,21,4],[37,6,22,4],[37,10,22,8,"result"],[37,16,22,14],[37,19,22,17,"initialValue"],[37,31,22,29],[38,6,23,4],[38,10,23,8,"cancelled"],[38,19,23,17],[38,22,23,20],[38,27,23,25],[39,6,24,4],[39,12,24,10,"streamFnContext"],[39,27,24,25],[39,30,24,28],[39,34,24,28,"addConsumeAwareSignal"],[39,42,24,49],[39,43,24,49,"addConsumeAwareSignal"],[39,64,24,49],[39,66,25,6],[40,8,26,8,"client"],[40,14,26,14],[40,16,26,16,"context"],[40,23,26,23],[40,24,26,24,"client"],[40,30,26,30],[41,8,27,8,"meta"],[41,12,27,12],[41,14,27,14,"context"],[41,21,27,21],[41,22,27,22,"meta"],[41,26,27,26],[42,8,28,8,"queryKey"],[42,16,28,16],[42,18,28,18,"context"],[42,25,28,25],[42,26,28,26,"queryKey"],[42,34,28,34],[43,8,29,8,"pageParam"],[43,17,29,17],[43,19,29,19,"context"],[43,26,29,26],[43,27,29,27,"pageParam"],[43,36,29,36],[44,8,30,8,"direction"],[44,17,30,17],[44,19,30,19,"context"],[44,26,30,26],[44,27,30,27,"direction"],[45,6,31,6],[45,7,31,7],[45,9,32,6],[45,15,32,12,"context"],[45,22,32,19],[45,23,32,20,"signal"],[45,29,32,26],[45,31,33,6],[45,37,33,12,"cancelled"],[45,46,33,21],[45,49,33,24],[45,53,34,4],[45,54,34,5],[46,6,35,4],[46,12,35,10,"stream"],[46,18,35,16],[46,21,35,19],[46,27,35,25,"streamFn"],[46,35,35,33],[46,36,35,34,"streamFnContext"],[46,51,35,49],[46,52,35,50],[47,6,36,4],[47,12,36,10,"isReplaceRefetch"],[47,28,36,26],[47,31,36,29,"isRefetch"],[47,40,36,38],[47,44,36,42,"refetchMode"],[47,55,36,53],[47,60,36,58],[47,69,36,67],[48,6,37,4],[48,17,37,15],[48,23,37,21,"chunk"],[48,28,37,26],[48,32,37,30,"stream"],[48,38,37,36],[48,40,37,38],[49,8,38,6],[49,12,38,10,"cancelled"],[49,21,38,19],[49,23,38,21],[50,10,39,8],[51,8,40,6],[52,8,41,6],[52,12,41,10,"isReplaceRefetch"],[52,28,41,26],[52,30,41,28],[53,10,42,8,"result"],[53,16,42,14],[53,19,42,17,"reducer"],[53,26,42,24],[53,27,42,25,"result"],[53,33,42,31],[53,35,42,33,"chunk"],[53,40,42,38],[53,41,42,39],[54,8,43,6],[54,9,43,7],[54,15,43,13],[55,10,44,8,"context"],[55,17,44,15],[55,18,44,16,"client"],[55,24,44,22],[55,25,44,23,"setQueryData"],[55,37,44,35],[55,38,45,10,"context"],[55,45,45,17],[55,46,45,18,"queryKey"],[55,54,45,26],[55,56,46,11,"prev"],[55,60,46,15],[55,64,46,20,"reducer"],[55,71,46,27],[55,72,46,28,"prev"],[55,76,46,32],[55,81,46,37],[55,86,46,42],[55,87,46,43],[55,90,46,46,"initialValue"],[55,102,46,58],[55,105,46,61,"prev"],[55,109,46,65],[55,111,46,67,"chunk"],[55,116,46,72],[55,117,47,8],[55,118,47,9],[56,8,48,6],[57,6,49,4],[58,6,50,4],[58,10,50,8,"isReplaceRefetch"],[58,26,50,24],[58,30,50,28],[58,31,50,29,"cancelled"],[58,40,50,38],[58,42,50,40],[59,8,51,6,"context"],[59,15,51,13],[59,16,51,14,"client"],[59,22,51,20],[59,23,51,21,"setQueryData"],[59,35,51,33],[59,36,51,34,"context"],[59,43,51,41],[59,44,51,42,"queryKey"],[59,52,51,50],[59,54,51,52,"result"],[59,60,51,58],[59,61,51,59],[60,6,52,4],[61,6,53,4],[61,13,53,11,"context"],[61,20,53,18],[61,21,53,19,"client"],[61,27,53,25],[61,28,53,26,"getQueryData"],[61,40,53,38],[61,41,53,39,"context"],[61,48,53,46],[61,49,53,47,"queryKey"],[61,57,53,55],[61,58,53,56],[61,62,53,60,"initialValue"],[61,74,53,72],[62,4,54,2],[62,5,54,3],[63,2,55,0],[64,0,55,1],[64,3]],"functionMap":{"names":["<global>","streamedQuery","<anonymous>","addConsumeAwareSignal$argument_1","addConsumeAwareSignal$argument_2","context.client.setQueryData$argument_1"],"mappings":"AAA;ACI;YCG,wCD;SCG;MCqB,oBD;MEC,sBF;UGa,+DH;GDQ;CDC"},"hasCjsExports":false},"type":"js/module"}]}